generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Model for storing game images
model Image {
  id             String @id @default(uuid())
  name           String @unique
  description    String
  imageUrl       String @unique @map("image_url")
  publicId       String @unique @map("public_id")
  originalWidth  Int    @map("original_width")
  originalHeight Int    @map("original_height")

  characterLocations CharacterLocation[]
  gameCompletions    GameCompletion[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

// Model for storing the locations of characters on each GameImage
model CharacterLocation {
  id            String @id @default(uuid())
  characterName String @map("character_name")

  targetXRatio    Float @map("target_x_ratio")
  targetYRatio    Float @map("target_y_ratio")
  toleranceXRatio Float @map("tolerance_x_ratio")
  toleranceYRatio Float @map("tolerance_y_ratio")

  image   Image  @relation(fields: [imageId], references: [id], onDelete: Cascade)
  imageId String @map("image_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([imageId, characterName])
  @@map("character_locations")
}

// Model for storing game completion records
model GameCompletion {
  id               String @id @default(uuid())
  playerName       String @map("player_name")
  timeTakenSeconds Float  @map("time_taken_seconds")

  image       Image    @relation(fields: [imageId], references: [id], onDelete: Cascade)
  imageId     String   @map("image_id")
  completedAt DateTime @default(now()) @map("completed_at")

  @@map("game_completions")
}
